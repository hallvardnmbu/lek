<!DOCTYPE html>
<html>

<head>
    <title>lek</title>
    <link rel="stylesheet" href="/styles.css">

    <script>
        // Inject Client ID for modules
        window.SPOTIFY_CLIENT_ID = '<%= id %>'; // Ensure this variable is passed from backend

        if (!sessionStorage.getItem('token')) {
            window.location.href = '/spotify';
        } else if (!sessionStorage.getItem('settings')) {
            window.location.href = '/settings';
        }
    </script>
    <script type="module" src="/scripts/main.js"></script>
</head>

<body>
    <span id="star"></span>
    <script>
        const star = {
            object: document.getElementById('star'),
            frame: 1,
            frames: 10
        };

        function updateStar() {
            star.object.innerHTML = `<img src="/icons/animations/star/Star (${star.frame} of ${star.frames}).ico">`;
            star.frame = star.frame >= star.frames ? 1 : star.frame + 1;
        }

        updateStar();
        setInterval(updateStar, 200);
    </script>

    <br>

    <hr>

    <section>
        <span id="game-information">for kontrollfreaker:</span>

        <button id="pause-game">pause!</button>
        <button id="resume-game" disabled>ferdig hvilt!</button>
        <button id="continue-button" style="display: none;">fortsett NÅ!</button>
    </section>

    <footer>
        <span id="explosion" style="height: calc(4 * var(--fontsize));"></span>
        <button id="explode" onclick="playExplosion()">Pang.</button>
        <script>
            let explosion = {
                object: document.getElementById('explosion'),
                frame: 1,
                frames: 3,
                playing: false,
                interval: null
            };

            function playExplosion() {
                if (explosion.playing) return;

                explosion.playing = true;
                explosion.frame = 1;

                explosion.interval = setInterval(() => {
                    if (explosion.frame <= explosion.frames) {
                        explosion.object.innerHTML = `<img src="/icons/animations/explosion/Explosion (${explosion.frame} of ${explosion.frames}).ico">`;
                    } else {
                        clearInterval(explosion.interval);
                        explosion.playing = false;
                        explosion.object.innerHTML = "";
                    }

                    explosion.frame++;
                }, 200);
            }
        </script>

        <hr>

        <span>
            <!-- These should ideally be hooked up via ID in main.js/ui-controller, but 
                  for now maintaining inline onclick for things I haven't ported or simple logic 
                  Wait, I ported these to spotify-service but they aren't globally available anymore.
                  I need to hook these buttons up in ui-controller! -->
            For å styre sangen som spilles:
            <!-- Removing buttons from HTML that rely on global functions, adding IDs -->
            <button id="btn-pause-song">pause</button> den,
            <button id="btn-play-song">starte</button> den igjen eller
            <button id="btn-skip-song">hoppe over</button> den.
        </span>

        <span>
            Du kan også endre lydnivået ved å dra på
            <input type="range" id="volumeSlider" min="0" max="100" value="50" />,
            eller endre tidsintervall ved å dra på
            <input type="range" id="delaySlider" min="1" max="8" value="2" />. Jeg
            velger å ikke vise deg verdiene. Du får prøve deg litt frem.
        </span>

        <hr>

        <span>
            Hallo! Jeg er dum og har gjort noe feil. Send meg tilbake til
            <a href="/settings">innstillinger</a>
            for å fikse det. Eller vil du kanskje helt tilbake til
            <a href="/spotify">spotify-innlogging</a>?
            Nåja. For noe styr.
        </span>

        <hr>
    </footer>

    <!-- Simple script to attach listeners for the footer buttons which I didn't handle in ui-controller yet -->
    <script type="module">
        import { pauseSong, playSong, skipSong } from '/scripts/services/spotify-service.js';

        document.getElementById('btn-pause-song').addEventListener('click', () => pauseSong());
        document.getElementById('btn-play-song').addEventListener('click', () => playSong());
        document.getElementById('btn-skip-song').addEventListener('click', () => skipSong());
    </script>
</body>

</html>